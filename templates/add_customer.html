
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Customer - Zephyr CMS</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<style>
  .add-customer-container { max-width: 600px; margin: 2rem auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);}
  .add-customer-container h2 { text-align:center; margin-bottom: 1rem; }
  .add-customer-container input, .add-customer-container select { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
  .add-customer-container button { background: #4facfe; color:white; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; }
  .add-customer-container button:hover { background:#00f2fe; }
  .order-line { border: 1px solid #eee; padding: 10px; margin-bottom:10px; border-radius:8px; }
</style>
</head>
<body>
  <div class="add-customer-container">
    <h2>Add Customer</h2>
    <form method="POST" action="{{ url_for('add_customer') }}">
      <input type="text" name="name" placeholder="Customer Name" required>
      <input type="date" name="visit_date" required>

      <div id="orders_container">
        <div class="order-line">
          <select name="order_type[]" onchange="updateOrderOptions(this)" required>
            <option value="">Select Order</option>
            <option value="budbod">Budbod (Rice Meal)</option>
            <option value="burger">Burger</option>
            <option value="busog_combo">Busog Combo</option>
            <option value="fries">Fries</option>
          </select>
          <div class="order_options"></div>
          <div class="add_ons"></div>
          <input type="number" name="quantity[]" value="1" min="1" onchange="updateLineTotal(this)">
          <input type="number" name="amount[]" value="0" readonly>
        </div>
      </div>
      <button type="button" onclick="addOrderLine()">+ Add Another Order</button>
      <h3>Total Amount: ₱<input type="number" id="total_amount" name="total_amount" value="0" readonly></h3>
      <button type="submit">Add Customer</button>
    </form>
    <br>
    <a href="{{ url_for('dashboard') }}">⬅ Back to Dashboard</a>
  </div>

<script>
const PRICES = {
  budbod: { pork:85, chicken:85, hungarian:85, rice:15, egg:15 },
  burger: { quarter:80, half_pound:155, jalapeno:15, cheese:15, bbq_sauce:15 },
  busog_combo: { Q1:115, H1:185 },
  fries: { small:25, medium:35, large:45 }
};

function updateOrderOptions(select) {
  const container = select.closest(".order-line");
  const optionsDiv = container.querySelector(".order_options");
  optionsDiv.innerHTML = "";

  const type = select.value;
  if (!PRICES[type]) return;

  const opt = document.createElement("select");
  opt.onchange = () = updateLineTotal(opt);

  for (let key in PRICES[type]) {
    opt.innerHTML += `<option value="${key}">${key}</option>`;
  }
  optionsDiv.appendChild(opt);
}

function updateLineTotal(el) {
  const line = el.closest(".order-line");
  const type = line.querySelector("select[name='order_type[]']").value;
  const option = line.querySelector(".order_options select")?.value;
  const qty = line.querySelector("input[name='quantity[]']").value;

  if (!type || !option) return;

  const price = PRICES[type][option];
  const amountInput = line.querySelector("input[name='amount[]']");
  amountInput.value = price;

  calculateTotal();
}

function calculateTotal() {
  let total = 0;
  document.querySelectorAll(".order-line").forEach(line = {
    const qty = line.querySelector("input[name='quantity[]']").value;
    const amt = line.querySelector("input[name='amount[]']").value;
    total += qty * amt;
  });
  document.getElementById("total_amount").value = total;
}

function addOrderLine() {
  const container = document.getElementById("orders_container");
  const clone = container.children[0].cloneNode(true);
  clone.querySelectorAll("input").forEach(i = i.value = i.name === "quantity[]" ? 1 : 0);
  clone.querySelector(".order_options").innerHTML = "";
  container.appendChild(clone);
}
</script>
</body>
</html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Customer - Zephyr CMS</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<style>
  .add-customer-container { max-width: 600px; margin: 2rem auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);}
  .add-customer-container h2 { text-align:center; margin-bottom: 1rem; }
  .add-customer-container input, .add-customer-container select { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
  .add-customer-container button { background: #4facfe; color:white; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; }
  .add-customer-container button:hover { background:#00f2fe; }
  .order-line { border: 1px solid #eee; padding: 10px; margin-bottom:10px; border-radius:8px; }
</style>
</head>
<body>
  <div class="add-customer-container">
    <h2>Add Customer</h2>
    <form method="POST" action="{{ url_for('add_customer') }}">
      <input type="text" name="name" placeholder="Customer Name" required>
      <input type="date" name="visit_date" required>

      <div id="orders_container">
        <div class="order-line">
          <select name="order_type[]" onchange="updateOrderOptions(this)" required>
            <option value="">Select Order</option>
            <option value="budbod">Budbod (Rice Meal)</option>
            <option value="burger">Burger</option>
            <option value="busog_combo">Busog Combo</option>
            <option value="fries">Fries</option>
          </select>
          <div class="order_options"></div>
          <div class="add_ons"></div>
          <input type="number" name="quantity[]" value="1" min="1" onchange="updateLineTotal(this)">
          <input type="number" name="amount[]" value="0" readonly>
        </div>
      </div>
      <button type="button" onclick="addOrderLine()">+ Add Another Order</button>
      <h3>Total Amount: ₱<input type="number" id="total_amount" name="total_amount" value="0" readonly></h3>
      <button type="submit">Add Customer</button>
    </form>
    <br>
    <a href="{{ url_for('dashboard') }}">⬅ Back to Dashboard</a>
  </div>

<script>
const PRICES = {
  budbod: { pork:85, chicken:85, hungarian:85, rice:15, egg:15 },
  burger: { quarter:80, half_pound:155, jalapeno:15, cheese:15, bbq_sauce:15 },
  busog_combo: { Q1:115, H1:185 },
  fries: { small:25, medium:35, large:45 }
};

function updateOrderOptions(select) {
  const container = select.closest(".order-line");
  const optionsDiv = container.querySelector(".order_options");
  optionsDiv.innerHTML = "";

  const type = select.value;
  if (!PRICES[type]) return;

  const opt = document.createElement("select");
  opt.onchange = () = updateLineTotal(opt);

  for (let key in PRICES[type]) {
    opt.innerHTML += `<option value="${key}">${key}</option>`;
  }
  optionsDiv.appendChild(opt);
}

function updateLineTotal(el) {
  const line = el.closest(".order-line");
  const type = line.querySelector("select[name='order_type[]']").value;
  const option = line.querySelector(".order_options select")?.value;
  const qty = line.querySelector("input[name='quantity[]']").value;

  if (!type || !option) return;

  const price = PRICES[type][option];
  const amountInput = line.querySelector("input[name='amount[]']");
  amountInput.value = price;

  calculateTotal();
}

function calculateTotal() {
  let total = 0;
  document.querySelectorAll(".order-line").forEach(line = {
    const qty = line.querySelector("input[name='quantity[]']").value;
    const amt = line.querySelector("input[name='amount[]']").value;
    total += qty * amt;
  });
  document.getElementById("total_amount").value = total;
}

function addOrderLine() {
  const container = document.getElementById("orders_container");
  const clone = container.children[0].cloneNode(true);
  clone.querySelectorAll("input").forEach(i = i.value = i.name === "quantity[]" ? 1 : 0);
  clone.querySelector(".order_options").innerHTML = "";
  container.appendChild(clone);
}
</script>
</body>
</html>
